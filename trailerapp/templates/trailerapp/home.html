{% extends 'trailerapp/base.html' %}
{% load icons %}

{% block title %}
    {{ page_title }}
{% endblock %}

{% block content %}
    {% if films %}
        <div class="infinite-container">
            {% for film in films %}
                <div class="infinite-item">
                    <h3>{{ film.title }}</h3>
                    <p>
                        <small>{{ film.release_date }}</small>
                    </p>
                    <video
                            id="{{ film.trailer_set.first.site_key }}"
                            class="video-js vjs-default-skin"
                            controls
                            width="640"
                            height="264"
                            data-setup='{
                                "techOrder": ["youtube"],
                                "sources": [{
                                    "type": "video/youtube",
{#                                    "src": "https://www.youtube.com/watch?v={{ film.trailer_set.first.site_key }}"#}
                                    "src": "https://www.youtube.com/embed/{{ film.trailer_set.first.site_key }}?rel=0"
                                }]
                            }'
                    ></video>
                </div>
            {% endfor %}
        </div>
        <div class="loading" style="display: none;">
            Loading...
        </div>
        {% if page_obj.has_next %}
            <a class="infinite-more-link" href="?page={{ page_obj.next_page_number }}">More</a>
        {% endif %}
        <script>
            var infinite = new Waypoint.Infinite({
                element: $('.infinite-container')[0],
                onBeforePageLoad: function () {
                    $('.loading').show();
                },
                onAfterPageLoad: function ($items) {
                    $('.loading').hide();
                }
            });
        </script>
    {% else %}
        <p>No films found.</p>
    {% endif %}
{% endblock %}